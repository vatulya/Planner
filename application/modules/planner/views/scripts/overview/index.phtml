<?php $this->headScript()->appendFile('/js/overview.js'); ?>

<div class="span12 group-overview-container">
    <!--div class="group-overview-header">
        <div class="year-total pull-left">
            <a href="#" class="show-tooltip no-action" data-original-title="09:00 - 18:00">
                <span class="param-name">Year totals:</span>
                <span class="">2</span>
            </a>
        </div>
        <div class="export-button pull-right">
            <button class="btn btn-small">
                Export
            </button>
        </div>
    </div-->

<?php foreach ($this->groups as $group): ?>
<?php $this->group = $group; ?>
<div
        class="row user_row width-full"
        id="<?php echo $this->group['id']; ?>"
        data-user-id="<?php echo $this->group['id']; ?>"
        >
    <?php
    $this->users = $this->group['users'];
    $nextWeekYear = $this->nextWeekYear;
    $prevWeekYear = $this->prevWeekYear;
    $currentWeekYear = $this->currentWeekYear;
    ?>
    <div class="user_row_container">
        <span class="span4 block-history">
            <a href="<?php echo $this->url(array('controller' => 'overview', 'action' => 'index', 'year' => $prevWeekYear['year'], 'week' => $prevWeekYear['week']), 'planner', true); ?>" rel="tooltip" class="bootstrab-tooltip get-week-details" title="<?php echo 'Year:' . $prevWeekYear['year'] . ' week:' . $prevWeekYear['week']; ?>">
                < Prev Week
            </a>
            <?php if ($currentWeekYear['week'] != $this->week): ?>
            <a href="<?php echo $this->url(array('controller' => 'overview', 'action' => 'index', 'year' => $currentWeekYear['year'], 'week' => $currentWeekYear['week']), 'planner', true); ?>" class="show-more-history"  title="<?php echo 'Year:' . $currentWeekYear['year'] . ' week:' . $currentWeekYear['week']; ?>">
                | Actual Week |
            </a>
            <a href="<?php echo $this->url(array('controller' => 'overview', 'action' => 'index', 'year' => $nextWeekYear['year'], 'week' => $nextWeekYear['week']), 'planner', true); ?>" rel="tooltip" class="bootstrab-tooltip get-week-details" title="<?php echo 'Year:' . $nextWeekYear['year'] . ' week:' . $nextWeekYear['week']; ?>">
                Next Week >
            </a>
            <?php endif; ?>
                <div class="history-container-scrollable">
                    <div class="history-container">
                        <?php echo $this->render('_blocks/history.phtml'); ?>
                    </div>
                </div>
        </span>


        <span
                class="span10 block-week-details week-details main-data-container user-id-<?php echo $this->group['id']; ?> year-<?php echo $this->weekTasks['year']; ?> week-<?php echo $this->weekTasks['week']; ?>"
                data-year="<?php echo $this->weekTasks['year']; ?>"
                data-week="<?php echo $this->weekTasks['week']; ?>"
                data-userId="<?php echo $this->group['id']; ?>"
                >

            <div class="group-history-block pull-left">
                <div class="div-row">&nbsp;</div>
                <div class="group-free-days-table">
                    <table class="history table table-bordered table-condensed table-striped">
                        <thead>
                        <tr class="week-table-header" >
                            <th>&nbsp;</th>
                        </tr>
                        <tr  class="week-table-header" style="background-color: #<?php echo $this->group['color'];?>">
                            <th>
                                Open
                                <a href="#" class="show-tooltip no-action" data-original-title="Openstaande saldo"><i class="icon-info-sign"></i></a>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                            <?php if (empty($this->users)): ?>
                                <tr><td >&nbsp;  </td></tr>
                            <?php else: ?>
                            <?php foreach ($this->users as $user): ?>
                                <?php $this->user = $user; ?>
                                <tr class="user-row add-user-row" data-user-id="<?php echo $user['user_id']; ?>">
                                    <td>
                                        <span><?php echo 0 ?></span>
                                        <a href="#" class="no-action pull-right underflow-container editable"
                                           data-field-title="Openstaande saldo"
                                           data-field-name="free_time"
                                           data-field-value="<?php echo $user['weekHours']['work_hours']; ?>"
                                           data-field-group="<?php echo $this->group['id']; ?>"
                                           data-field-user="<?php echo $user['user_id']; ?>"
                                           data-field-week="<?php echo $this->week; ?>"
                                           data-field-year="<?php echo $this->year; ?>"
                                                ><i class="icon-edit"></i></a>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            <?php endif; ?>

                        </tbody>
                    </table>
                </div>
            </div>

       <div class="group-overview-block pull-left">
           <div class="div-row">&nbsp;</div>
            <table class="history table table-bordered table-condensed table-striped">

                <thead>
                <tr class="week-table-header" >
                    <th  colspan="4"   ></th>
                    <!--th  style="background-color: #<?php echo $this->group['color'];?>" -->
                    <th>
                        <a href="#" class="bootstrab-tooltip no-action get-week-details" >
                            Week <?php echo $this->week; ?>
                        </a>
                    </th>
                </tr>
                    <tr class="week-table-header" style="background-color: #<?php echo $this->group['color'];?>">
                        <th class="group-user-name" ><?php echo $this->group['group_name']; ?></th>
                        <th class="group-user-worked">Gewerkte uren</th>
                        <th class="group-user-used-free-days">Vrije uren</th>
                        <th class="group-user-overtime">Overuren</th>
                        <th class="group-user-doctor-days">Ziekte/buitengew</th>
                    </tr>
                    </thead>
                    <tbody>
                    <?php if (empty($this->users)): ?>
                <td colspan="7" class="user-not-found">
                    No users in this group
                </td>
                    <?php else: ?>
                    <?php foreach ($this->users as $user): ?>
                        <?php $this->user = $user; ?>
                        <?php //echo $this->render('planning/_blocks/week_user_plan.phtml'); ?>
                        <tr class="user-row add-user-row" data-user-id="<?php echo $user['user_id']; ?>">
                            <td class="user-title" >
                                <div><?php echo "<nobr>" . $user['full_name'] . "</nobr>"; ?> </div>
                            </td>
                            <td>
                                <span><?php echo $user['weekHours']['work_hours']  ?></span>
                                <a href="#" class="no-action pull-right underflow-container editable"
                                   data-field-title="Gewerkte uren"
                                   data-field-name="work_time"
                                   data-field-value="<?php echo $user['weekHours']['work_hours']; ?>"
                                   data-field-group="<?php echo $this->group['id']; ?>"
                                   data-field-user="<?php echo $user['user_id']; ?>"
                                   data-field-week="<?php echo $this->week; ?>"
                                   data-field-year="<?php echo $this->year; ?>"
                                ><i class="icon-edit"></i></a>
                            </td>
                            <td>
                                <span><?php echo $user['weekHours']['vacation_hours']  ?></span>
                                <a href="#" class="no-action pull-right underflow-container editable"
                                   data-field-title="Vrije uren"
                                   data-field-name="vacation_time"
                                   data-field-value="<?php echo $user['weekHours']['vacation_hours']; ?>"
                                   data-field-group="<?php echo $this->group['id']; ?>"
                                   data-field-user="<?php echo $user['user_id']; ?>"
                                   data-field-week="<?php echo $this->week; ?>"
                                   data-field-year="<?php echo $this->year; ?>"
                                        ><i class="icon-edit"></i></a>
                            </td>
                            <td>
                                <span><?php echo $user['weekHours']['overtime_hours']  ?></span>
                                <a href="#" class="no-action pull-right underflow-container editable"
                                   data-field-title="Overuren"
                                   data-field-name="overtime_time"
                                   data-field-value="<?php echo $user['weekHours']['overtime_hours']; ?>"
                                   data-field-group="<?php echo $this->group['id']; ?>"
                                   data-field-user="<?php echo $user['user_id']; ?>"
                                   data-field-week="<?php echo $this->week; ?>"
                                   data-field-year="<?php echo $this->year; ?>"
                                        ><i class="icon-edit"></i></a>
                            </td>
                            <td>
                                <span><?php echo $user['weekHours']['missing_hours']  ?></span>
                                <a href="#" class="no-action pull-right underflow-container editable"
                                   data-field-title="Ziekte/buitengew"
                                   data-field-name="missing_time"
                                   data-field-value="<?php echo $user['weekHours']['missing_hours']; ?>"
                                   data-field-group="<?php echo $this->group['id']; ?>"
                                   data-field-user="<?php echo $user['user_id']; ?>"
                                   data-field-week="<?php echo $this->week; ?>"
                                   data-field-year="<?php echo $this->year; ?>"
                                        ><i class="icon-edit"></i></a>
                            </td>


                        </tr>
                        <?php endforeach; ?>
                    <?php endif; ?>
                </tbody>
            </table>
        </div>

    </span>
    </div>
</div>
<?php endforeach; ?>

</div>

<!-- DEFAULT EDIT POPOVER -->
<div id="popover-edit-field-html" style="display: none;">
    <div class="popover-container" data-user="" data-group="" data-week="" data-year="" >
        <div class="input-append">
            <input type="text" name="" value="" class="input-edit-field for-focus">
            <button class="btn btn-success submit-popover-edit-field" type="button">Save</button>
        </div>
    </div>
</div>